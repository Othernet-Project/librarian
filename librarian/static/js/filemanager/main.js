// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  'use strict';
  var activateSidebar, closeSidebar, mainContainer, openSidebar, toggleSidebar, updateState;
  mainContainer = $('#main-container');
  window.mainContainer = mainContainer;
  activateSidebar = function() {
    var sidebar, winWidth;
    if (templates.sidebarRetract == null) {
      return;
    }
    ($('#views-container')).data('has-sidebar', true);
    sidebar = $('#views-sidebar');
    sidebar.addClass('with-sidebar-handle');
    sidebar.prepend(templates.sidebarRetract);
    winWidth = ($(window)).outerWidth();
    if (winWidth < 740) {
      setTimeout(function() {
        return toggleSidebar();
      }, 2000);
    }
  };
  toggleSidebar = function() {
    var container;
    container = $('#views-container');
    if (!container.data('has-sidebar')) {
      return;
    }
    container.toggleClass('sidebar-hidden');
    ($(window)).trigger('views-sidebar-toggled');
  };
  openSidebar = function() {
    ($('#views-container')).removeClass('sidebar-hidden');
    ($(window)).trigger('views-sidebar-toggled');
  };
  closeSidebar = function() {
    ($('#views-container')).addClass('sidebar-hidden');
    ($(window)).trigger('views-sidebar-toggled');
  };
  updateState = function() {
    return mainContainer.data('view', ($('.views-tabs-tab-current')).data('view'));
  };
  window.loadContent = function(url) {
    var res;
    res = $.get(url);
    res.done(function(data) {
      mainContainer.html(data);
      (mainContainer.find('a')).first().focus();
      activateSidebar();
      updateState();
      window.triggerTabChange();
    });
    res.fail(function() {
      return alert(templates.alertLoadError);
    });
    return res;
  };
  mainContainer.on('click', '.views-tabs-tab-link', function(e) {
    var elem, res, url;
    e.preventDefault();
    e.stopPropagation();
    elem = $(this);
    url = elem.attr('href');
    res = loadContent(url);
    return res.done(function() {
      window.history.pushState(null, null, url);
      window.triggerTabChange();
    });
  });
  window.onTabChange = function(func) {
    window.mainContainer.on('filemanager:tabchanged', func);
  };
  window.triggerTabChange = function() {
    window.mainContainer.trigger('filemanager:tabchanged');
  };
  window.changeLocation = function(url) {
    window.history.pushState(null, null, url);
  };
  $(window).on('popstate', function(e) {
    loadContent(window.location);
  });
  updateState();
  activateSidebar();
  mainContainer.on('click', '.views-sidebar-retract', toggleSidebar);
  ($(window)).on('views-sidebar-toggle', toggleSidebar);
  ($(window)).on('views-sidebar-close', closeSidebar);
  ($(window)).on('views-sidebar-open', openSidebar);
})(this, this.jQuery, this.templates);
