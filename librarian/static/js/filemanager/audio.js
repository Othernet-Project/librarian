// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  'use strict';
  var musicPlayer, playNext, prepareAudio;
  playNext = function(e) {
    var next, player;
    player = e.data;
    next = ($('.playlist-list-item-current')).next('.playlist-list-item');
    if (next.length) {
      musicPlayer.playlist.next();
      musicPlayer.player.play();
    }
  };
  musicPlayer = Object.create(mediaPlayer);
  musicPlayer["super"] = mediaPlayer;
  musicPlayer.initialize = function(container) {
    var features;
    features = {
      toggleSidebarOnSelect: false
    };
    this.audioData = JSON.parse($("#audioData").html());
    this["super"].initialize.call(this, container, features);
  };
  musicPlayer.readyPlayer = function() {
    var controls;
    controls = this.container.find('#audio-controls-audio').first();
    controls.mediaelementplayer({
      features: ['playpause', 'progress', 'duration', 'volume'],
      success: (function(_this) {
        return function(mediaElement) {
          mediaElement.play();
          _this.onPlayerReady(mediaElement);
        };
      })(this)
    });
  };
  musicPlayer.updatePlayer = function(item, autoPlay) {
    this["super"].updatePlayer.call(this, item, autoPlay);
    this.updateCover(item.data('get-thumb-url'), this.audioData.defaultThumbUrl);
  };
  musicPlayer.updateCover = function(url, defaultUrl) {
    var options, res;
    options = this.options;
    res = $.get(url);
    res.done(function(data) {
      var cover;
      cover = $(options.coverSelector);
      if (data.url) {
        cover.attr('src', data.url);
        cover.addClass(options.customCoverClass);
      } else {
        cover.attr('src', defaultUrl);
        cover.removeClass(options.customCoverClass);
      }
    });
  };
  prepareAudio = function() {
    var controls;
    controls = $('#audio-controls');
    if (!controls.length) {
      return;
    }
    musicPlayer.initialize($("#main-container"));
    ($(musicPlayer.player)).on('ended', musicPlayer, playNext);
    ($('#audio-controls-albumart')).on('click', function(e) {
      e.preventDefault();
      if (musicPlayer.player.paused) {
        musicPlayer.player.play();
      } else {
        musicPlayer.player.pause();
      }
    });
    ($(window)).on('playlist-updated', function() {
      var artist, title, trackInfo;
      trackInfo = ($('.playlist-list-item-current')).data();
      title = trackInfo.title;
      artist = trackInfo.author || trackInfo.artist || template.unknownAuthor;
      ($('#audio-controls-title h2')).text(title);
      return ($('#audio-controls-title p')).text(artist);
    });
  };
  $(prepareAudio);
  window.onTabChange(prepareAudio);
})(this, this.jQuery, this.templates);
