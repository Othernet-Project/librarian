// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var applyOverride, fullPatch, mainContainer, needsOverride, onFrameLoad, partialPatch, readerFrame, setup;
  mainContainer = $('#main-container');
  readerFrame = null;
  applyOverride = function(doc, style) {
    var link, override;
    override = readerFrame.data("override-" + style);
    link = "<link rel=\"stylesheet\" href=\"" + override + "\">";
    (doc.find('head')).append(link);
  };
  fullPatch = function(doc) {
    var override;
    console.log('full');
    override = readerFrame.data('override-styling');
    (doc.find('style')).remove();
    (doc.find('link[rel="stylesheet"]')).remove();
    applyOverride(doc, 'full');
  };
  partialPatch = function(doc) {
    applyOverride(doc, 'partial');
  };
  needsOverride = function(doc) {
    return ((doc.find('meta[name="outernet-styling"]')).attr('name')) === 'yes';
  };
  onFrameLoad = function() {
    var doc, override;
    override = readerFrame.data('override-styling');
    doc = readerFrame.contents();
    if (needsOverride(doc)) {
      fullPatch(doc);
    } else {
      partialPatch(doc);
    }
  };
  setup = function() {
    if ((mainContainer.data('view')) !== 'html') {
      return;
    }
    readerFrame = $('#views-reader-frame');
    if (!readerFrame.length) {
      setTimeout(setup, 200);
      return;
    }
    return readerFrame.on('load', function() {
      if ((readerFrame.contents().prop('readyState')) === 'complete') {
        return onFrameLoad();
      }
    });
  };
  window.onTabChange(setup);
  setup();
})(this, this.jQuery, this.templates);
