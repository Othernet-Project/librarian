// Generated by CoffeeScript 1.10.0
(function(window, $) {
  var countDisplaySelector, createField, deleteNotification, doc, formSelector, notificationAlertSelector, notificationListSelector, notificationSelector, separatorSelector, updateNotificationCount;
  doc = $(document);
  notificationAlertSelector = '.unread-notifications';
  notificationListSelector = '#notification-list';
  notificationSelector = '.notification';
  separatorSelector = '.separator';
  countDisplaySelector = '.unread-notification-count';
  formSelector = '.notification form';
  updateNotificationCount = function() {
    var countEl, notificationAlertEl, remaining;
    remaining = $(notificationListSelector).find(notificationSelector).length;
    notificationAlertEl = $(notificationAlertSelector);
    countEl = notificationAlertEl.find(countDisplaySelector);
    countEl.text(remaining);
    if (remaining === 0) {
      notificationAlertEl.hide();
      return notificationAlertEl.prev(separatorSelector).hide();
    }
  };
  createField = function(name, value) {
    var input;
    input = $('<input>');
    input.attr('type', 'hidden');
    input.attr('name', name);
    input.val(value);
    return input;
  };
  deleteNotification = function(e) {
    var button, elem, form, input, res, url;
    elem = $(this);
    form = elem.parents(formSelector);
    url = form.attr('action');
    button = form.find('button');
    input = createField(button.attr('name'), button.val());
    form.append(input);
    res = $.post(url, form.serialize());
    res.done(function() {
      form.parent().remove();
      return updateNotificationCount();
    });
    return e.preventDefault();
  };
  return doc.on('tab-opened', function(e) {
    var notificationList;
    notificationList = $(notificationListSelector);
    return notificationList.on('click', '.notification-delete', deleteNotification);
  });
})(this, this.jQuery);
