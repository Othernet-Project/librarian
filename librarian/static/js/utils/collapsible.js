// Generated by CoffeeScript 1.10.0
(function(window, $) {
  var CLICKABLE_TARGET, ESC, RETURN, SPACE, win;
  CLICKABLE_TARGET = 42;
  RETURN = 13;
  SPACE = 32;
  ESC = 27;
  win = $(window);
  $.collapsibleDefaults = {
    button: '.o-collapsible-section-title',
    collapsibleArea: '.o-collapsible-section-panel',
    collapsibleSection: '.o-collapsible-section',
    collapseClass: 'o-collapsed'
  };
  return $.fn.collapsible = function(options) {
    var button, collapseClass, collapsibleArea, collapsibleSection, collapsibleSections, elem, expand, onclick, remax;
    elem = $(this);
    if (options == null) {
      options = {};
    }
    options = $.extend(options, $.collapsibleDefaults);
    button = options.button, collapsibleArea = options.collapsibleArea, collapsibleSection = options.collapsibleSection, collapseClass = options.collapseClass;
    remax = function() {
      var panel, section, totalHeight;
      section = $(this);
      panel = section.find(collapsibleArea);
      totalHeight = panel.outerHeight();
      section.css('max-height', totalHeight + CLICKABLE_TARGET);
      return section;
    };
    expand = function(panel) {
      var section;
      section = panel.parents(collapsibleSection);
      button = section.find(button);
      section.addClass(collapseClass);
      panel.ariaProperty('hidden', 'true');
      return button.focus();
    };
    collapsibleSections = elem.find(collapsibleSection);
    collapsibleSections.each(function() {
      var section;
      section = remax.call(this);
      section.data('collapsible-parent', elem);
      section.on('remax', remax);
      return win.on('resize', (function(_this) {
        return function() {
          return remax.call(_this);
        };
      })(this));
    });
    onclick = function(e) {
      var clicked, collapsed, panel, section;
      e.preventDefault();
      clicked = $(e.target);
      section = clicked.parents(collapsibleSection);
      panel = section.find(collapsibleArea);
      section.toggleClass(collapseClass);
      collapsed = section.hasClass(collapseClass);
      panel.ariaProperty('hidden', collapsed ? 'true' : 'false');
      return panel.focus();
    };
    elem.on('click', button, onclick);
    elem.on('keydown', collapsibleSection, function(e) {
      var panel, section;
      if (e.which !== ESC) {
        return;
      }
      panel = $(e.target);
      section = panel.parents(collapsibleSection);
      button = section.find(button);
      section.addClass(collapseClass);
      panel.ariaProperty('hidden', 'true');
      return button.focus();
    });
    return elem;
  };
})(this, this.jQuery);
