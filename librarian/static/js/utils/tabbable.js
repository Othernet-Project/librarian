// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var tabOpenedEvent;
  tabOpenedEvent = 'tab-opened';
  $.tabbableDefaults = {
    activator: '.o-tab-handle-activator',
    panel: '.o-tab-panel',
    spinnerTemplate: templates.spinner,
    errorTemplate: templates.loadFail
  };
  $.fn.tabbableCloseAll = function() {
    var activator, elem, options, panel;
    elem = $(this);
    options = elem.data('tabbableOptions');
    if (!options) {
      return;
    }
    activator = options.activator, panel = options.panel;
    (elem.find(panel + '.active')).removeClass('active').ariaProperty('expanded', 'false');
    (elem.find(activator + '.active')).removeClass('active');
    return elem;
  };
  $.fn.tabbableOpenTab = function(tabId, suppressEvent) {
    var activator, elem, options, panel, ref, res, tabs, url;
    elem = $(this);
    options = elem.data('tabbableOptions');
    tabs = elem.data('tabbableTabs');
    if (!options) {
      return;
    }
    ref = tabs[tabId], activator = ref.activator, panel = ref.panel;
    activator.addClass('active');
    panel.addClass('active');
    panel.ariaProperty('expanded', 'true');
    if (!suppressEvent) {
      elem.trigger('tabchange', [activator, panel]);
    }
    url = panel.data('url');
    if (!url) {
      return;
    }
    panel.html(options.spinnerTemplate);
    res = $.get(url);
    res.done(function(data) {
      panel.html(data);
      return $.event.trigger({
        type: tabOpenedEvent,
        tabId: tabId
      });
    });
    res.fail(function() {
      return panel.html(options.errorTemplate);
    });
    return elem;
  };
  return $.fn.tabable = function(options) {
    var activator, elem, onChange, panel, tabs;
    if (options == null) {
      options = {};
    }
    options = $.extend({}, $.tabbableDefaults, options);
    activator = options.activator, panel = options.panel, onChange = options.onChange;
    elem = $(this);
    elem.data('tabbableOptions', options);
    elem.data('tabbableTabs', tabs = {});
    (elem.find(activator)).each(function() {
      var act, href, id;
      act = $(this);
      href = act.attr('href');
      id = href.replace('#', '');
      panel = elem.find(href);
      tabs[id] = {
        activator: act,
        panel: panel
      };
    });
    tabs = null;
    elem.on('focus', activator, function(e) {
      return elem.trigger('activator-focus');
    });
    elem.on('click', activator, function(e) {
      var tabId;
      e.preventDefault();
      tabId = (($(this)).attr('href')).replace('#', '');
      elem.tabbableCloseAll();
      return elem.tabbableOpenTab(tabId);
    });
    return elem;
  };
})(this, this.jQuery, this.templates);
