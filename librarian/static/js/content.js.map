{"version":3,"file":"content.js","sources":["../../../assets/js/tags.js","../../../assets/js/list.js"],"names":["window","$","resetTagForm","e","newItems","initTagUIState","call","el","this","form","find","append","templates","closeTagButton","hide","tagButton","openTagForm","tags","parent","tagForm","next","show","focus","contentList","masonry","closeTagForm","parents","prev","val","getTags","updateTags","xhr","url","attr","tagList","buttons","preventDefault","prop","post","base_path","tagCloud","data","done","res","html","updateTagCloud","fail","updateError","always","length","load","alert","tagsUpdateError","map","text","get","join","win","doc","document","body","on","jQuery","updateHeight","winHeight","height","loadContent","docPos","docHeight","loading","scrollTop","page","totalPages","end","loadLink","params","p","contentQuery","search","contentPath","loader","insertContent","insertFailure","trim","loadEmpty","trigger","console","log","toggleToTopButton","toTop","fadeIn","fadeOut","animateTopScroll","animate","parseInt","location","pathname","URI","showToTop","_","debounce","isNaN","Array","isArray","after","click","remove"],"mappings":"CAAC,SAAUA,EAAQC,GAcjB,QAASC,GAAaC,EAAGC,GACvBC,EAAeC,KAAKF,GAGtB,QAASC,KACP,GAAIE,GAAKN,EAAEO,MACPC,EAAOF,EAAGG,KAAK,YACnBD,GAAKC,KAAK,WAAWC,OAAOC,UAAUC,gBACtCJ,EAAKK,OACLP,EAAGG,KAAK,SAASC,OAAOC,UAAUG,WAGpC,QAASC,GAAYb,GACnB,GAAII,GAAKN,EAAEO,MACPS,EAAOV,EAAGW,SACVC,EAAUF,EAAKG,KAAK,YACxBH,GAAKH,OACLK,EAAQE,OACRF,EAAQT,KAAK,SAASY,QACH,MAAfC,GAA8C,MAAvBA,EAAYC,SACrCD,EAAYC,UAIhB,QAASC,KACP,GAAIlB,GAAKN,EAAEO,MACPC,EAAOF,EAAGmB,QAAQ,aAClBT,EAAOR,EAAKkB,MAChBlB,GAAKK,OACLG,EAAKI,OACLZ,EAAKC,KAAK,SAASkB,IAAIC,EAAQZ,IACZ,MAAfM,GAA8C,MAAvBA,EAAYC,SACrCD,EAAYC,UAIhB,QAASM,GAAW3B,GAClB,GAAI4B,GACAtB,EAAOR,EAAEO,MACTwB,EAAMvB,EAAKwB,KAAK,UAChBhB,EAAOR,EAAKC,KAAK,SAASkB,MAC1BM,EAAUzB,EAAKkB,OACfQ,EAAU1B,EAAKC,KAAK,SAExBP,GAAEiC,iBACFD,EAAQE,KAAK,YAAY,GAEzBN,EAAM9B,EAAEqC,KAAKN,GAAMf,KAAMA,EAAMsB,UAAWC,EAASC,KAAK,eACxDV,EAAIW,KAAK,SAAUC,GACjBT,EAAQU,KAAKD,EAAM/B,UAAUG,WAC7BN,EAAKgC,KAAK,WAAYZ,EAAQK,IAC9BT,EAAanB,KAAK6B,GAClBU,MAEFd,EAAIe,KAAKC,GACThB,EAAIiB,OAAO,WAAcb,EAAQE,KAAK,YAAY,KAGpD,QAASQ,KACFL,EAASS,QAGdT,EAASU,KACLV,EAASC,KAAK,OACd,QACAD,EAASC,KAAK,WACd,cACAD,EAASC,KAAK,cAIpB,QAASM,KACPI,MAAMvC,UAAUwC,iBAGlB,QAASvB,GAAQtB,GACf,MAAOA,GAAGG,KAAK,KAAK2C,IAAI,WACtB,MAAOpD,GAAEO,MAAM8C,SACdC,MAAMC,KAAK,MA3FhB,CAAA,GAAIC,GAAMxD,EAAED,GACR0D,EAAMzD,EAAE0D,SAASC,MACjBrC,EAActB,EAAE,iBAChBuC,EAAWvC,EAAE,uBACAA,GAAE,gBAEnBwD,EAAII,GAAG,aAAc3D,GACrBwD,EAAIG,GAAG,QAAS,cAAe7C,GAC/B0C,EAAIG,GAAG,QAAS,oBAAqBpC,GACrCiC,EAAIG,GAAG,SAAU,YAAa/B,GAE9BzB,EAAeC,KAAKoD,IAkFpBlD,KAAMsD,QC9FP,SAAU9D,EAAQC,GAqDjB,QAAS8D,GAAa5D,GACpB6D,EAAYP,EAAIQ,SAGlB,QAASC,GAAY/D,GACnB,GAAIgE,GACAC,EACApC,EACAD,CAEJ,KAAIsC,EAAJ,CAMA,GALAA,GAAU,EAEVF,EAASV,EAAIa,YACbF,EAAYV,EAAIO,SAAuB,EAAZD,EAEdI,EAATD,EAEF,YADAE,GAAU,EAIZ,IAAIE,EAAO,EAAIC,EAKb,MAJAC,GAAIpD,OACJqD,EAAS5D,OACToD,EAAc,kBACdG,GAAU,EAMZM,GAAOC,EAAIL,GAAc,EACzBM,EAAaC,OAAOH,GACpB3C,EAAM+C,EAAcF,EAAaC,SAGjCJ,EAAS5D,OACTkE,EAAO3D,OACPU,EAAM9B,EAAEsD,IAAIvB,GACZD,EAAIW,KAAKuC,GACTlD,EAAIe,KAAKoC,IAGX,QAASD,GAActC,GAErB,MADAA,GAAM1C,EAAEkF,KAAKxC,GACD,KAARA,EAAqByC,KACzBzC,EAAM1C,EAAE0C,GACRpB,EAAYZ,OAAOgC,GACnBqC,EAAOlE,OACP4D,EAASrD,OACToC,EAAI4B,QAAQ,cAAe1C,SAC3B0B,GAAU,IAGZ,QAASa,KAEPI,QAAQC,IAAI,mBAGd,QAASH,KAEPE,QAAQC,IAAI,SAGd,QAASC,KACH/B,EAAIa,YAAcN,EACpByB,EAAMC,OAAO,KAEbD,EAAME,QAAQ,KAIlB,QAASC,GAAiBzF,GACxBA,EAAEiC,iBACFwB,EAAKiC,SAASvB,UAAa,GAAI,KA9HjC,GAMIN,GANAP,EAAMxD,EAAED,GACR0D,EAAMzD,EAAE0D,UACRC,EAAO3D,EAAE,aACTsB,EAActB,EAAE,iBAChBuE,EAAasB,SAASvE,EAAYkB,KAAK,SAAU,IAGjDuC,GAFS/E,EAAE,WAEFA,EAAEW,UAAUyD,UACrBI,EAAMxE,EAAEW,UAAU6D,KAClBgB,EAAQxF,EAAEW,UAAU6E,OACpBf,EAAWzE,EAAEW,UAAU8D,UACvBL,GAAU,EAEVU,EAAc/E,EAAO+F,SAASC,SAC9BnB,EAAe,GAAIoB,KAAIjG,EAAO+F,SAASjB,QACvCH,EAASE,EAAaC,QAAO,GAC7BP,EAAOuB,SAASnB,EAAOC,EAAG,IAE1BsB,EAAYC,EAAEC,SAASZ,EAAmB,KAGlC,MAARjB,GAAgB8B,MAAM9B,IAAS+B,MAAMC,QAAQhC,MAASA,EAAO,GAC7D8B,MAAM7B,KAAeA,EAAa,GAGlCA,EAAa,IACfjD,EAAYiF,MAAM9B,GAClBA,EAASb,GAAG,QAASK,IAIvB3C,EAAYiF,MAAMxB,GAClBA,EAAOlE,OACPS,EAAYiF,MAAM/B,GAClBA,EAAI3D,OACJS,EAAYiF,MAAMf,GAClBA,EAAM3E,OAGNb,EAAE,WAAWwG,MAAMb,GAGnB7B,IAGA9D,EAAE,gBAAgByG,SAClBzG,EAAE,WAAWyG,SACbjD,EAAII,GAAG,SAAUqC,GACjBzC,EAAII,GAAG,SAAUE,IAiFjBvD,KAAMsD","sourcesContent":["(function (window, $) {\n  var win = $(window);\n  var doc = $(document.body);\n  var contentList = $('#content-list');\n  var tagCloud = $('#tag-cloud-container');\n  var currentTag = $('#current-tag');\n\n  win.on('listUpdate', resetTagForm);\n  doc.on('click', '.tag-button', openTagForm);\n  doc.on('click', '.tag-close-button', closeTagForm);\n  doc.on('submit', '.tag-form', updateTags);\n\n  initTagUIState.call(doc);\n\n  function resetTagForm(e, newItems) {\n    initTagUIState.call(newItems);\n  }\n\n  function initTagUIState() {\n    var el = $(this);\n    var form = el.find('.tag-form');\n    form.find('p:first').append(templates.closeTagButton);\n    form.hide();\n    el.find('.tags').append(templates.tagButton);\n  }\n\n  function openTagForm(e) {\n    var el = $(this);\n    var tags = el.parent();\n    var tagForm = tags.next('.tag-form');\n    tags.hide();\n    tagForm.show();\n    tagForm.find('input').focus();\n    if (contentList != null && contentList.masonry != null) {\n      contentList.masonry();\n    }\n  }\n\n  function closeTagForm() {\n    var el = $(this);\n    var form = el.parents('.tag-form');\n    var tags = form.prev();\n    form.hide();\n    tags.show();\n    form.find('input').val(getTags(tags));\n    if (contentList != null && contentList.masonry != null) {\n      contentList.masonry();\n    }\n  }\n\n  function updateTags(e) {\n    var xhr;\n    var form = $(this);\n    var url = form.attr('action');\n    var tags = form.find('input').val();\n    var tagList = form.prev();\n    var buttons = form.find('button');\n\n    e.preventDefault();\n    buttons.prop('disabled', true);\n\n    xhr = $.post(url, {tags: tags, base_path: tagCloud.data('base-path')});\n    xhr.done(function (res) {\n      tagList.html(res + templates.tagButton);\n      form.data('original', getTags(tagList));\n      closeTagForm.call(buttons);\n      updateTagCloud();\n    });\n    xhr.fail(updateError);\n    xhr.always(function () { buttons.prop('disabled', false); });\n  }\n\n  function updateTagCloud() {\n    if (!tagCloud.length) {\n        return;\n    }\n    tagCloud.load(\n        tagCloud.data('url') +\n        '?tag=' +\n        tagCloud.data('current') +\n        '&base_path=' +\n        tagCloud.data('base-path')\n    );\n  }\n\n  function updateError() {\n    alert(templates.tagsUpdateError);\n  }\n\n  function getTags(el) {\n    return el.find('a').map(function () {\n      return $(this).text();\n    }).get().join(', ');\n  }\n}(this, jQuery));\n","(function (window, $) {\n  var win = $(window);\n  var doc = $(document);\n  var body = $('html,body');\n  var contentList = $('#content-list');\n  var totalPages = parseInt(contentList.data('total'), 10);\n  var footer = $('.footer');\n  var winHeight;\n  var loader = $(templates.loading);\n  var end = $(templates.end);\n  var toTop = $(templates.toTop);\n  var loadLink = $(templates.loadLink);\n  var loading = false;\n\n  var contentPath = window.location.pathname;\n  var contentQuery = new URI(window.location.search);\n  var params = contentQuery.search(true);\n  var page = parseInt(params.p, 10);\n\n  var showToTop = _.debounce(toggleToTopButton, 50);\n\n  // Normalize pager vales\n  if (page == null || isNaN(page) || Array.isArray(page)) { page = 1; }\n  if (isNaN(totalPages)) { totalPages = 1; }\n\n  // Content loading\n  if (totalPages > 1) {\n    contentList.after(loadLink);\n    loadLink.on('click', loadContent);\n  }\n\n  // Preload the spinner and other elements\n  contentList.after(loader);\n  loader.hide();\n  contentList.after(end);\n  end.hide();\n  contentList.after(toTop);\n  toTop.hide();\n\n  // Go-to-top animation\n  $('.to-top').click(animateTopScroll);\n\n  // Fix height data\n  updateHeight();\n\n  // Inifinite scrolling\n  $('.pager-links').remove();  // No pager needed\n  $('.paging').remove();\n  win.on('scroll', showToTop);\n  win.on('resize', updateHeight);\n\n  // Utility functions and callbacks\n\n  function updateHeight(e) {\n    winHeight = win.height();\n  }\n\n  function loadContent(e) {\n    var docPos;\n    var docHeight;\n    var url;\n    var xhr;\n\n    if (loading) { return; }\n    loading = true;\n\n    docPos = win.scrollTop();\n    docHeight = doc.height() - winHeight * 2;\n\n    if (docPos < docHeight) { \n      loading = false;\n      return; \n    }\n\n    if (page + 1 > totalPages) {\n      end.show();\n      loadLink.hide();\n      loadContent = function () {};\n      loading = false;\n      return;\n    }\n\n    \n    // Formulate params for the new page\n    params.p = page = page + 1;\n    contentQuery.search(params);\n    url = contentPath + contentQuery.search();\n\n    // Fetch the HTML data\n    loadLink.hide();\n    loader.show();\n    xhr = $.get(url);\n    xhr.done(insertContent);\n    xhr.fail(insertFailure);\n  }\n\n  function insertContent(res) {\n    res = $.trim(res);\n    if (res === '') { return loadEmpty(); }\n    res = $(res);\n    contentList.append(res);\n    loader.hide();\n    loadLink.show();\n    win.trigger('listUpdate', [res]);\n    loading = false;\n  }\n\n  function insertFailure() {\n    // TODO: implement failure handling\n    console.log('Not implemented');\n  }\n\n  function loadEmpty() {\n    // TODO: implement loading empty\n    console.log('Empty');\n  }\n\n  function toggleToTopButton() {\n    if (win.scrollTop() > winHeight) {\n      toTop.fadeIn(200);\n    } else {\n      toTop.fadeOut(200);\n    }\n  }\n\n  function animateTopScroll(e) {\n    e.preventDefault();\n    body.animate({'scrollTop': 0}, 500);\n  }\n\n}(this, jQuery));\n"]}