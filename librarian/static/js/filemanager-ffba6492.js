// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  'use strict';
  var DOWN, UP, body, container, fileList, loadContent, mainPanel, modalDialogTemplate;
  UP = 38;
  DOWN = 40;
  fileList = $('#file-list');
  container = $('#file-list-container');
  body = $(document.body);
  mainPanel = $("#" + window.o.pageVars.mainPanelId);
  modalDialogTemplate = window.templates.modalDialogCancelOnly;
  loadContent = function(url) {
    var res;
    res = $.get(url);
    res.done(function(data) {
      container.html(data);
      window.history.pushState(data, null, url);
      return container.find('a').first().focus();
    });
    res.fail(function() {
      return alert(templates.alertLoadError);
    });
  };
  mainPanel.on('keydown', '.file-list-link', function(e) {
    var elem, listItem;
    elem = $(this);
    listItem = elem.parents('.file-list-item');
    switch (e.which) {
      case UP:
        listItem.prev().find('a').focus();
        e.preventDefault();
        break;
      case DOWN:
        listItem.next().find('a').focus();
        e.preventDefault();
    }
  });
  mainPanel.on('click', '.file-list-link', function(e) {
    var elem, isDir, openerUrl, res, url;
    elem = $(this);
    openerUrl = elem.data('opener-url');
    isDir = elem.hasClass('file-list-directory');
    if (openerUrl != null) {
      e.preventDefault();
      e.stopPropagation();
      $.modalContent(openerUrl, {
        successTemplate: modalDialogTemplate
      });
      return;
    }
    if (elem.data('type') === 'directory') {
      e.preventDefault();
      e.stopPropagation();
      url = elem.attr('href');
      res = $.get(elem.attr('href'));
      res.done(function(data) {
        container.html(data);
        window.history.pushState(null, null, url);
        return container.find('a').first().focus();
      });
      res.fail(function() {
        return alert(templates.alertLoadError);
      });
    }
  });
  return $(window).on('popstate', function(e) {
    var url;
    if (window.history.state != null) {
      container.html(window.history.state);
      return container.find('a').first().focus();
    } else {
      url = window.location;
      return loadContent(url);
    }
  });
})(this, this.jQuery, this.templates);
